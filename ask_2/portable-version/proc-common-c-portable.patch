--- ../forktree/proc-common.c	2011-12-15 11:50:05.284780817 +0200
+++ proc-common.c	2011-12-21 20:41:05.544935655 +0200
@@ -3,10 +3,42 @@
 #include <unistd.h>
 #include <assert.h>
 #include <string.h>
-#include <sys/prctl.h>
 #include <sys/wait.h>
 
 #include "proc-common.h"
+//Using Operating Systems Predefined Macros
+//as defined in [1]
+//[1] http://sourceforge.net/apps/mediawiki/predef/index.php?title=Operating_Systems
+#ifdef __linux__
+#include <sys/prctl.h>
+void
+change_pname(const char *new_name)
+{
+	int ret;
+	ret = prctl(PR_SET_NAME, new_name);
+	if (ret == -1){
+		perror("prctl set_name");
+		exit(1);
+	}
+}
+#elif __bsdi__   //assuming BSD
+void
+change_pname(const char *new_name)
+{
+    setproctitle("%s",new_name);
+    
+}
+#elif __APPLE__
+void
+change_pname(const char *new_name)
+{
+    //nothing here yet
+    //unsigned int old_len=strlen(proc_name);
+    //memset(proc_name,'\0',old_len);
+    //snprintf(proc_name,old_len,"%s",new_name);
+    //proc_name[old_len]='\0';
+}
+#endif
 
 void
 wait_forever(void)
@@ -20,16 +52,6 @@
  * Changes the process name, as appears in ps or pstree,
  * using a Linux-specific system call.
  */
-void
-change_pname(const char *new_name)
-{
-	int ret;
-	ret = prctl(PR_SET_NAME, new_name);
-	if (ret == -1){
-		perror("prctl set_name");
-		exit(1);
-	}
-}
 
 /*
  * This function receives an integer status value,
@@ -99,7 +121,11 @@
 	int ret;
 	char cmd[1024];
 
+#ifdef linux
 	snprintf(cmd, sizeof(cmd), "echo; echo; pstree -G -c -p %ld; echo; echo",
+#else //assuming bsd
+	snprintf(cmd, sizeof(cmd), "echo; echo; pstree -g -c -p %ld; echo; echo",
+#endif
 		(long)p);
 	cmd[sizeof(cmd)-1] = '\0';
 	ret = system(cmd);
